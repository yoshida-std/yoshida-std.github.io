<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <title>Trampoline Pro</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial Black', sans-serif; touch-action: none; }
        #game-container { position: relative; width: 100vw; height: 100vh; overflow: hidden; }
        canvas { display: block; background: radial-gradient(circle at 30% 20%, #1a1a2e 0%, #050505 100%); }

        #orientation-warning {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #111; color: white; z-index: 100; flex-direction: column; 
            justify-content: center; align-items: center; text-align: center;
        }
        @media (orientation: portrait) { #orientation-warning { display: flex; } }

        .controls { 
            position: absolute; bottom: 0; width: 100%; height: 85px; 
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(20, 20, 40, 0.8); border-top: 2px solid #444; padding: 0 10px; box-sizing: border-box; z-index: 20;
        }
        .btn { 
            width: 48%; height: 65px; background: linear-gradient(#333, #111); 
            border: 2px solid #888; border-radius: 12px; display: flex; 
            justify-content: center; align-items: center; color: #fff; font-size: 28px; user-select: none;
        }
        .btn:active { background: #555; border-color: #00f2fe; color: #00f2fe; }

        .info { 
            position: absolute; top: 10px; width: 100%; text-align: center;
            color: #fff; pointer-events: none; z-index: 10;
        }
        #scoreDisplay { font-size: 32px; color: #00f2fe; text-shadow: 0 0 10px rgba(0,242,254,0.5); }
    </style>
</head>
<body>

<div id="orientation-warning">
    <div style="font-size: 50px;">üîÑ</div>
    <p>ÁîªÈù¢„ÇíÊ®™Âêë„Åç„Å´ÂõûËª¢„Åï„Åõ„Å¶„Åè„Å†„Åï„ÅÑ</p>
</div>

<div id="game-container">
    <div class="info">
        <div id="scoreDisplay">0</div>
        <div style="font-size: 12px; color: #888;">GOALS: <span id="goalCount">0</span> | BALLS: <span id="ballCount">1</span></div>
    </div>
    <canvas id="gameCanvas"></canvas>
    <div class="controls">
        <div class="btn" id="leftBtn">LEFT</div>
        <div class="btn" id="rightBtn">RIGHT</div>
    </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('scoreDisplay');
const goalEl = document.getElementById('goalCount');
const ballCountEl = document.getElementById('ballCount');

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

let score = 0;
let goals = 0;
let activeBalls = [];
let droppedBalls = [];
let goalMessages = []; // „ÄåOK!„Äç„É°„ÉÉ„Çª„Éº„Ç∏Áî®
let armAngle = 0;

const player = {
    x: canvas.width / 2 - 70,
    get y() { return canvas.height - 100; }, // „Éú„Çø„É≥„ÅÆÂ∞ë„Åó‰∏ä
    w: 140, h: 20, bend: 0, speed: 18
};

function createBall() {
    const patterns = [{vx: 3, vy: -2}, {vx: 5.5, vy: 1}, {vx: 2, vy: -8}];
    const p = patterns[Math.floor(Math.random() * patterns.length)];
    armAngle = Math.PI;
    return {
        x: 40, y: 70, radius: 10,
        vx: p.vx, vy: p.vy, gravity: 0.25,
        color: `hsl(${Math.random() * 360}, 80%, 60%)`
    };
}

activeBalls.push(createBall());

let left = false, right = false;
document.getElementById('leftBtn').ontouchstart = (e) => { e.preventDefault(); left = true; };
document.getElementById('leftBtn').ontouchend = () => left = false;
document.getElementById('rightBtn').ontouchstart = (e) => { e.preventDefault(); right = true; };
document.getElementById('rightBtn').ontouchend = () => right = false;

function update() {
    if (left && player.x > 0) player.x -= player.speed;
    if (right && player.x < canvas.width - player.w) player.x += player.speed;
    player.bend *= 0.85;

    // „É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÊõ¥Êñ∞
    goalMessages.forEach((m, i) => {
        m.y -= 1; m.life -= 0.02;
        if (m.life <= 0) goalMessages.splice(i, 1);
    });

    activeBalls.forEach((b, i) => {
        b.vy += b.gravity; b.x += b.vx; b.y += b.vy;

        if (b.y + b.radius > player.y && b.y < player.y + player.h &&
            b.x > player.x && b.x < player.x + player.w && b.vy > 0) {
            player.bend = Math.min(b.vy * 5, 45);
            b.vy *= -1.18; b.y = player.y - b.radius;
            b.radius += 3; score += 1;
            b.vx += (b.x - (player.x + player.w/2)) * 0.1;
        }

        if (b.y > canvas.height - 85 - b.radius) {
            b.y = canvas.height - 85 - b.radius;
            droppedBalls.push({...b});
            activeBalls[i] = createBall();
        }

        if (b.x > canvas.width + b.radius) {
            score += Math.floor(b.radius * 10);
            goals++;
            // OK!„É°„ÉÉ„Çª„Éº„Ç∏ÁîüÊàê
            goalMessages.push({x: canvas.width - 60, y: b.y, life: 1.0});
            if (goals % 5 === 0) activeBalls.push(createBall());
            activeBalls[i] = createBall();
        }
    });
    scoreEl.innerText = score;
    goalEl.innerText = goals;
    ballCountEl.innerText = activeBalls.length;
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // ‰∫∫
    ctx.strokeStyle = "#fff"; ctx.lineWidth = 2;
    const px = 30, py = 75;
    ctx.beginPath(); ctx.arc(px, py-25, 7, 0, Math.PI*2); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(px, py-18); ctx.lineTo(px, py); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(px, py-14);
    ctx.lineTo(px + Math.cos(armAngle)*20, py-14 + Math.sin(armAngle)*20); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(px, py); ctx.lineTo(px-7, py+12); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(px, py); ctx.lineTo(px+7, py+12); ctx.stroke();
    armAngle *= 0.88;

    // Âú∞Èù¢„ÅÆÁéâ
    droppedBalls.forEach(b => {
        ctx.globalAlpha = 0.3; ctx.fillStyle = b.color;
        ctx.beginPath(); ctx.arc(b.x, b.y, b.radius, 0, Math.PI*2); ctx.fill();
    });
    ctx.globalAlpha = 1.0;

    // „Éà„É©„É≥„Éù„É™„É≥„ÅÆ„Éá„Ç∂„Ç§„É≥ÊèèÁîª
    // 1. „Éï„É¨„Éº„É†(Ê®™Ê£í)
    ctx.fillStyle = "#555";
    ctx.fillRect(player.x, player.y, player.w, 6);
    // 2. „Éç„ÉÉ„Éà(„Åó„Å™„ÇäÈÉ®ÂàÜ)
    ctx.strokeStyle = "#00f2fe"; ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(player.x + 10, player.y + 3);
    ctx.quadraticCurveTo(player.x + player.w/2, player.y + 3 + player.bend, player.x + player.w - 10, player.y + 3);
    ctx.stroke();
    // 3. ÊîØÊü±(ËÑö)
    ctx.fillStyle = "#888";
    ctx.fillRect(player.x + 5, player.y + 6, 6, 15);
    ctx.fillRect(player.x + player.w - 11, player.y + 6, 6, 15);

    // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™Áéâ
    activeBalls.forEach(b => {
        ctx.shadowBlur = 15; ctx.shadowColor = b.color;
        ctx.fillStyle = b.color;
        ctx.beginPath(); ctx.arc(b.x, b.y, b.radius, 0, Math.PI*2); ctx.fill();
        ctx.shadowBlur = 0;
        ctx.fillStyle = "#fff"; ctx.font = "bold 12px Arial";
        ctx.fillText(`+${Math.floor(b.radius*10)}`, b.x - 10, b.y - b.radius - 5);
    });

    // „ÄåOK!„Äç„É°„ÉÉ„Çª„Éº„Ç∏
    goalMessages.forEach(m => {
        ctx.globalAlpha = m.life;
        ctx.fillStyle = "#00ff00";
        ctx.font = "bold 30px Arial";
        ctx.fillText("OK!", m.x, m.y);
    });
    ctx.globalAlpha = 1.0;
}

function loop() { update(); draw(); requestAnimationFrame(loop); }
loop();
</script>
</body>
</html>
